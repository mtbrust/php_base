{% block corpo %}

{# A view é a última "else"



DESENHA O POST *********************************************************************************************************
#}
{% if attr[0] == 'post' %}
<div class="row">
    <div class="col-xs-12">
        <p class="m-0">Post</p>
    </div>
</div>

{# DESENHA O PUT
********************************************************************************************************* #}
{% elseif attr[0] == 'put' %}
<div class="row">
    <div class="col-xs-12">
        <p class="m-0">Put</p>
    </div>
</div>

{# DESENHA O GET
********************************************************************************************************* #}
{% elseif attr[0] == 'get' %}
{{calender | raw}}

{# DESENHA O DELETE
********************************************************************************************************* #}
{% elseif attr[0] == 'delete' %}
<div class="row">
    <div class="col-xs-12">
        <p class="m-0">Delete</p>
    </div>
</div>


{# DESENHA O TEST
********************************************************************************************************* #}
{% elseif attr[0] == 'test' %}
<div class="row">
    <div class="col-xs-12">
        <p class="m-0">TEST</p>
    </div>
</div>

{# DESENHA A VIEW
********************************************************************************************************* #}
{% else %}

<head>
    <!-- Fonte do Google -->
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="{{PATH_MODEL_ADMIN}}plugins/fontawesome-free/css/all.min.css">
    <!-- fullCalendar -->
    <link rel="stylesheet" href="{{PATH_MODEL_ADMIN}}plugins/fullcalendar/main.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="{{PATH_MODEL_ADMIN}}assets/css/adminlte.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<!-- Card de Eventos -->
<section class="content">
    <div class="">
        <div class="row">
            <div class="col-md-3 d-none">
                <div class="sticky-top mb-3">
                    <div class="card">
                        <div class="card-header">
                            <h4 class="card-title">Eventos</h4>
                        </div>
                        <div class="card-body">
                            <!-- Os Eventos -->
                            <div id="external-events">
                                <div class="external-event bg-success">Teste</div>
                                <div class="external-event bg-warning">Teste</div>
                                <div class="external-event bg-info">Teste</div>
                                <div class="external-event bg-primary">Teste</div>
                                <div class="external-event bg-danger">Teste</div>
                                <div class="checkbox">
                                    <label for="drop-remove">
                                        <input type="checkbox" id="drop-remove">
                                        Remover aviso
                                    </label>
                                </div>
                            </div>
                        </div>
                        <!-- Fim do Eventos -->
                    </div>
                    <!-- Fim do Card de Eventos -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Criar Evento</h3>
                        </div>
                        <div class="card-body">
                            <div class="btn-group" style="width: 100%; margin-bottom: 10px;">
                                <ul class="fc-color-picker" id="color-chooser">
                                    <li><a class="text-primary" href="#"><i class="fas fa-square"></i></a></li>
                                    <li><a class="text-warning" href="#"><i class="fas fa-square"></i></a></li>
                                    <li><a class="text-success" href="#"><i class="fas fa-square"></i></a></li>
                                    <li><a class="text-danger" href="#"><i class="fas fa-square"></i></a></li>
                                    <li><a class="text-muted" href="#"><i class="fas fa-square"></i></a></li>
                                </ul>
                            </div>
                            <!-- /btn-group -->
                            <div class="input-group">
                                <input id="new-event" type="text" class="form-control" placeholder="Título do Evento">

                                <div class="input-group-append">
                                    <button id="add-new-event" type="button" class="btn btn-primary">Adicionar</button>
                                </div>
                                <!-- /btn-group -->
                            </div>
                            <!-- /input-group -->
                        </div>
                    </div>
                </div>
            </div>
            <!-- /.col -->
            <div class="col-md-12">
                <div class="card card-primary">
                    <div class="card-body p-0">
                        <!-- THE CALENDAR -->
                        <div id="calendar"></div>
                    </div>
                    <!-- /.card-body -->
                </div>
                <!-- /.card -->
            </div>
            <!-- /.col -->

            <!-- Modal de Detalhes do Evento -->
            <div class="modal fade" id="visualizar" tabindex="-1" aria-labelledby="exampleModalLabel"
                aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Detalhes do Evento</h5>
                            <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close">
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="visEvento">
                                <dl class="row">
                                    <dt class="col-sm-3">ID do Evento</dt>
                                    <dd class="col-sm-9" id="id"></dd>
                                    <dt class="col-sm-3">Título do Evento</dt>
                                    <dd class="col-sm-9" id="title"></dd>
                                    <dt class="col-sm-3">Inicio do Evento</dt>
                                    <dd class="col-sm-9" id="start"></dd>
                                    <dt class="col-sm-3">Fim do Evento</dt>
                                    <dd class="col-sm-9" id="end"></dd>
                                </dl>
                                <button class="btn btn-warning btn-cancel">Editar</button>
                                <a class="btn btn-danger" id="deleta" name="deleta" value="deleta">Deletar</a>
                            </div>
                            <div class="formEdit">

                                <form id="editaEvento" method="post" enctype="multipart/form-data">

                                            <input type="hidden"  name="id" id="id">



                                    <div class="form-group row">
                                        <label class="col-sm-2 col-form-label">Título</label>
                                        <div class="col-sm-10">
                                            <input type="text" class="form-control" name="title" id="title"
                                                value="{{eventos[1]['id']}}">
                                        </div>
                                    </div>

                                    <div class="form-group row">
                                        <label class="col-sm-2 col-form-label">Cores</label>
                                        <div class="col-sm-10">
                                            <select class="form-select" aria-label="Default select example" name="color"
                                                id="color">
                                                <option disabled selected>Escolha uma cor para o evento</option>
                                                <option style="color: #FF0000" value="#FF0000">Vermelho</option>
                                                <option style="color: #1E90FF" value="#1E90FF">Azul</option>
                                                <option style="color: #FF00FF" value="#FF00FF">Rosa</option>
                                                <option style="color: #FFFF00" value="#FFFF00">Amarelo</option>
                                                <option style="color: #FF7F00" value="#FF7F00">Laranja</option>
                                                <option style="color: #A0522D" value="#A0522D">Marron</option>
                                                <option style="color: #000000" value="#000000">Preto</option>
                                                <option style="color: #00FF00" value="#00FF00">Verde</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div class="form-group row">
                                        <label class="col-sm-2 col-form-label">Data de Início</label>
                                        <div class="col-sm-10">
                                            <input type="datetime-local" class="form-control" name="start" id="start"
                                                onkeypress="DataHora(event, this)">
                                        </div>
                                    </div>

                                    <div class="form-group row">
                                        <label class="col-sm-2 col-form-label">Data de Fim</label>
                                        <div class="col-sm-10">
                                            <input type="datetime-local" class="form-control" name="end" id="end"
                                                onkeypress="DataHora(event, this)">
                                        </div>
                                    </div>

                                    <div class="form-group row">

                                        <div class="col-sm-10">
                                            <button type="button"
                                                class="btn btn-primary btn-cancel-edit">Cancelar</button>
                                            <button type="submit" name="editaEvento" id="editaEvento" value="editaEvento"
                                                class="btn btn-success">Alterar</button>
                                        </div>
                                    </div>
                                </form>

                            </div>
                        </div>

                    </div>
                </div>
            </div>


            <!-- Modal Cadastro -->
            <div class="modal fade" id="cadastrar" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Cadastrar Eventos</h5>
                            <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close">
                            </button>
                        </div>
                        <div class="modal-body">
                            <form id="addEvento" method="post" enctype="multipart/form-data">

                                <div class="form-group row">
                                    <label class="col-sm-2 col-form-label">Título</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" name="title" id="title"
                                            placeholder="Título do Evento">
                                    </div>
                                </div>

                                <div class="form-group row">
                                    <label class="col-sm-2 col-form-label">Cores</label>
                                    <div class="col-sm-10">
                                        <select class="form-select" aria-label="Default select example" name="color"
                                            id="color">
                                            <option disabled selected>Escolha uma cor para o evento</option>
                                            <option style="color: #FF0000" value="#FF0000">Vermelho</option>
                                            <option style="color: #1E90FF" value="#1E90FF">Azul</option>
                                            <option style="color: #FF00FF" value="#FF00FF">Rosa</option>
                                            <option style="color: #FFFF00" value="#FFFF00">Amarelo</option>
                                            <option style="color: #FF7F00" value="#FF7F00">Laranja</option>
                                            <option style="color: #A0522D" value="#A0522D">Marron</option>
                                            <option style="color: #000000" value="#000000">Preto</option>
                                            <option style="color: #00FF00" value="#00FF00">Verde</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="form-group row">
                                    <label class="col-sm-2 col-form-label">Data de Início</label>
                                    <div class="col-sm-10">
                                        <input type="datetime-local" class="form-control" name="start" id="start">
                                    </div>
                                </div>

                                <div class="form-group row">
                                    <label class="col-sm-2 col-form-label">Data de Fim</label>
                                    <div class="col-sm-10">
                                        <input type="datetime-local" class="form-control" name="end" id="end">
                                    </div>
                                </div>

                                <div class="form-group row">
                                    <div class="col-sm-10">
                                        <button type="submit" name="cadEvento" id="cadEvento" value="cadEvento"
                                            class="btn btn-success">Cadastrar</button>
                                    </div>
                                </div>
                            </form>
                        </div>

                    </div>
                </div>
            </div>

        </div>
        <!-- /.row -->
    </div><!-- /.container-fluid -->
</section>
<!-- /.content -->
</div>
<!-- /.content-wrapper -->

<!-- Control Sidebar -->
<aside class="control-sidebar control-sidebar-dark">
    <!-- Control sidebar content goes here -->
</aside>
<!-- /.control-sidebar -->
</div>
<!-- ./wrapper -->

<style>
    .visEvento {
        display: block;
    }

    .formEdit {
        display: none;
    }
</style>


<!-- Scripts Carregados na Página -->

<script src="{{PATH_MODEL_ADMIN}}assets/admin/plugins/fullcalendar/locales/pt-br.js"></script>
<script>
    $(function () {

        /* Inicia os Eventos
         -----------------------------------------------------------------*/
        function ini_events(ele) {
            ele.each(function () {

                // Cria o Evento Objeto
                var eventObject = {
                    title: $.trim($(this).text()) // Usa o elemento texto no título
                }

                // Armazena o Event Object no elemento DOM para que possamos acessá-lo mais tarde
                $(this).data('eventObject', eventObject)

                // Torna o evento arrastavel usando JQuery UI
                $(this).draggable({
                    zIndex: 1070,
                    revert: true, // Faz com evento retorne a origem mesmo depois de arrastar
                    revertDuration: 0  //  Retorna a posição original depois de arrastar
                })

            })
        }

        ini_events($('#external-events div.external-event')) /*Inicia o evento calendário


         -----------------------------------------------------------------*/
        //Data para os eventos do calendário
        var date = new Date()
        var d = date.getDate(),
            m = date.getMonth(),
            y = date.getFullYear()

        var Calendar = FullCalendar.Calendar;
        var Draggable = FullCalendar.Draggable;

        var containerEl = document.getElementById('external-events');
        var checkbox = document.getElementById('drop-remove');
        var calendarEl = document.getElementById('calendar');

        // Inicia eventos externos
        // -----------------------------------------------------------------

        new Draggable(containerEl, {
            itemSelector: '.external-event',
            eventData: function (eventEl) {
                return {
                    title: eventEl.innerText,
                    backgroundColor: window.getComputedStyle(eventEl, null).getPropertyValue('background-color'),
                    borderColor: window.getComputedStyle(eventEl, null).getPropertyValue('background-color'),
                    textColor: window.getComputedStyle(eventEl, null).getPropertyValue('color'),
                };
            }
        });

        var calendar = new Calendar(calendarEl, { //Instancia um novo calendário
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,timeGridWeek,timeGridDay'
            },
            locale: 'pt-br', // Deixa o js em português
            themeSystem: 'bootstrap', //Define o tema a ser usado
            eventLimit: true, //Define se o evento terá um limite
            //Eventos do calendário
            events: {{ list_events | raw}}, //Chama a lista de eventos que vem do banco

        /*events: [
            {
                title          : 'All Day Event',
                start          : new Date(y, m, 1),
                backgroundColor: '#f56954', //red
                borderColor    : '#f56954', //red
                allDay         : true
            },
            {
                title          : 'Long Event',
                start          : new Date(y, m, d - 5),
                end            : new Date(y, m, d - 2),
                backgroundColor: '#f39c12', //yellow
                borderColor    : '#f39c12' //yellow
            },
            {
                title          : 'Meeting',
                start          : new Date(y, m, d, 10, 30),
                allDay         : false,
                backgroundColor: '#0073b7', //Blue
                borderColor    : '#0073b7' //Blue
            },

        ],*/
        eventClick: function(info) { //Inicia o evento click
            info.jsEvent.preventDefault();
            console.log(info.event);

            $('#deleta').attr("href", "{{URL_RAIZ}}admin/calendario/delete/" + info.event.id);//FUNÇÃO PARA DELETAR EVENTOS

            // EXIBIÇÃO
            $('#visualizar #title').text(info.event.title); //Chamando no modal que o id é visualizar a chave title. toLocaleString formata a dta para br
            $('#visualizar #start').text(info.event.start.toLocaleString());//Chamando no modal que o id é visualizar a chave start
            $('#visualizar #end').text(info.event.end.toLocaleString());//Chamando no modal que o id é visualizar a chave end
            $('#visualizar #color').text(info.event.color); //Chamando no modal que o id é visualizar a chave color
            $('#visualizar #id').text(info.event.id); //Chamando no modal que o id é visualizar a chave id

            // FORMULÁRIO EDITAR
            $('#visualizar #title').val(info.event.title); //Recebe o título
            var localISOTime = (new Date(Date.parse(info.event.start) - 10800000)).toISOString().slice(0, -1); //Trata a hora de inicio
            $('#visualizar #start').val(localISOTime);//Recebe a hora do inicio
            var localISOTime = (new Date(Date.parse(info.event.end) - 10800000)).toISOString().slice(0, -1); //Trata a hora de fim
            $('#visualizar #end').val(localISOTime);//Recebe a hora de fim
            $('#visualizar #color').val(info.event.backgroundColor); //Recebe a cor
            $('#visualizar #editaEvento').val(info.event.id); //Recebe o id

            // MODAL
            $('#visualizar').modal('show');//Modal com a chave visualizar é chamado

        },
        selectable: true, //Deixa tabela selecionavel
        select: function (info) {
            //alert('Inicio do Evento ' + info.start.toLocaleString()); //Lança um alerta de teste na tela
            $('#cadastrar #start').val(info.start.toLocaleString());
            $('#cadastrar #end').val(info.end.toLocaleString());
            $('#cadastrar').modal('show');
        },

        editable  : true,
        droppable : true, //Permite que coisas sejam inseridas no calendário
        drop      : function(info) {
            // A caixa de seleção "remover após soltar" está marcada?
            if (checkbox.checked) {
                // Se sim, remova o elemento da lista "Eventos arrastáveis"
                info.draggedEl.parentNode.removeChild(info.draggedEl);
            }
        }
        });

    //FUNÇÃO QUE NO CLIQUE MOSTRA O EVENTO E NÃO O EDITAR
    $('.btn-cancel').on("click", function () {
        $('.visEvento').slideToggle();
        $('.formEdit').slideToggle();
    });

    //FUNÇÃO QUE NO CLIQUE MOSTRA O EDITAR E NÃO O EVENTO
    $('.btn-cancel-edit').on("click", function () {
        $('.formEdit').slideToggle();
        $('.visEvento').slideToggle();
    });


    calendar.render();
    // $('#calendar').fullCalendar()

    /* Adiciona Eventos */
    var currColor = '#3c8dbc' //Vermelho por padrão
    // Escolhe a cor do botão
    $('#color-chooser > li > a').click(function (e) {
        e.preventDefault()
        // Salva a cor
        currColor = $(this).css('color')
        // Adiciona efeito de cor ao botão
        $('#add-new-event').css({
            'background-color': currColor,
            'border-color': currColor
        })
    })
    $('#add-new-event').click(function (e) {
        e.preventDefault()
        // Obtém valor e verifica se não é nulo
        var val = $('#new-event').val()
        if (val.length == 0) {
            return
        }

        // Cria eventos
        var event = $('<div />')
        event.css({
            'background-color': currColor,
            'border-color': currColor,
            'color': '#fff'
        }).addClass('external-event')
        event.text(val)
        $('#external-events').prepend(event)

        // Adiciona a funcionalidade arrastar
        ini_events(event)

        // Remove o evento de entrada de texto
        $('#new-event').val('')
    })
    })
</script>



{%endif%}
{% endblock %}
